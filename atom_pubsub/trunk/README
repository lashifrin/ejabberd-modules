# the Atom PubSub tunnel
# Eric Cestari <eric@ohmforce.com>
# http://www.cestari.info/
# 12-09-2008

# Licensed under the same terms as ejabberd (that would be some version of the GPL)

# About
The atom_pep module provides access to all PEP nodes via an AtomPub interface.
urn:xmpp:microblog is not a XEP yet, but its latest incarnation can be found here :
Also gives access to tune, mood and geoloc nodes if they exist.

http://www.xmpp.org/extensions/inbox/microblogging.html

AtomPub RFC : http://bitworking.org/projects/atom/rfc5023.html

URL for the service document for a given user@domain is :
http://<server>:5280/pep/<domain>/<user>

The atom_pubsub module provides access to all nodes below the /home/server/user tree.
SVC document : http://<server>:5280/pubsub/<domain>/<user>

# Install 
You need to run ejabberd trunk revision > 1561 or ejabberd 2.0.3 or later.


Compile using `make`
Copy beam file in your ejabberd installation.
Add the following request handler (around line 150 in ejabberd.cfg)
.
.
{8080, ejabberd_http, [
			 http_poll, 
			 web_admin,
			 {request_handlers, [{["pep"], atom_microblog}%Make sure it's "pep", or change it in the source code
								{["pubsub"], atom_pubsub}]}  %Make sure it's "pubsub", or change it in the source code
			
			]}
.
.
Restart ejabberd.

# What you get

Full caching support with Etag, Conditional Get, etc.

Authentication is required for writing, updating via Atom. Use your full JID as username for authentication.

It expects the payload to be an atom entry, but does not enforce it.

However, it has to be well formed XML.

# Can I have it with OpenFire and Epeios ?
That's not possible. atom_microblog needs direct access to the pubsub structures.

# What's next ?

- Better understanding of Atom entries. have better links, implement reply-to 

- Adding a local friend collection for personal use

- But that may be implemented in mod_pubsub/node_microblog.erl (it will arrive soon)



